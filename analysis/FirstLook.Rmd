---
title: "Logo and EDLogo"
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

<!-- Add your analysis here -->


## Standard Logo

### Simple Illustration

One of the primary applications of logo plots is in visualizing DNA sequence motif (e.g.: [seqLogo](http://bioconductor.org/packages/release/bioc/html/seqLogo.html)). These logo plots comorise of 4 characters (A,C,G and T) corresponding to the 4 bases. We start with an example application from [seqLogo](https://bioconductor.org/packages/release/bioc/html/seqLogo.html)  


```{r}
library(grid)
library(gridBase)
mFile <- system.file("Exfiles/pwm1", package="seqLogo")
m <- read.table(mFile)
p <- seqLogo::makePWM(m)
seqLogo::seqLogo(p)
```

We illustrate how a standard logo plot can be created in  **Logolas** using the . `logomaker()` function. 

```{r,message=FALSE,warning=FALSE}
library(Logolas)
color_profile <- list("type" = "per_row",
"col" = RColorBrewer::brewer.pal(dim(p@pwm)[1],name ="Spectral"))
logomaker(p@pwm,color_profile = color_profile, ic.scale = TRUE)
```

As evident from the above example, `logomaker` offers the user several options to stylize the plot.  

- **color_profile** : This option allows the user to specify the color palettes for different symbols. This is a list argument with two items - a `type` variable and a `color` variable. The `type` variable represents the coloring scheme and can be either of three choices - `per_row`, `per_symbol` and `per_column` depending on whether the user wants to fix a color for a specific row name of the PWM matrix, or for each column or for a specific character of an alphanumeric string. We shall discuss these different choices in greater detail in the next section. 


- **ic.scale** : If TRUE (which is also the default), Information Content (I.C)  is used to determine the stack heights in the logo plot. If FALSE, the stack heights are scaled to 1. 

### Information Criterion and Background Probabilities 

As default, `logomaker` assumes that the background probability of the occurrence of each base at a position is discrete uniform. However, when a background probability is known for a specific position of the sequence, the user may use that information to relatively scale the heights. 

The information content for position $i$ is then calculated as follows 

$$IC_i=\Sigma_b p_{b, i}\times \log_2p_{b, i}-(\Sigma_b p_{b,i}\times \log_2q_{b,i})$$

where $p_{b,i}$ is the relative frequency of base $b$ at position $i$ and $q_{b, i}$ is the background probability of base $b$ and position $i$. 

The background probability can be fixed through the input `bg` in `logomaker`.  `bg` can be a matrix, vector or NULL. When `bg` is a matrix, each position has a specific base probability $q_{b,i}$, if `bg` is a vector, it is assumed that $q_{b,i} = q_{b}$ for all $i$, and if NULL, the background probability is assumed to be same for all the bases ( for example - $q_{b,i} = 0.25$ for DNA/RNA sequence data with no specified `bg`). 

We present examples of Logolas with different options for `bg`. We plot here a multi-panel Logolas plot for different choices of `bg`. 

[A FIGURE GOES HERE]

```{r,message=FALSE,warning=FALSE}
logomaker(p@pwm,xlab = 'position',color_profile = color_profile,
          frame_width = 1,
          bg=c(0.32, 0.18, 0.2, 0.3),
          pop_name = 'Change background prob',
          control = list(viewport.margin.left = 5))
```



### Color palettes  in Logolas 

Logolas also allows the user to choose different color palettes 

```{r}
color_profile1=list("type" = "per_row",
"col" = RColorBrewer::brewer.pal(dim(p@pwm)[1],name ="PiYG"))
logomaker(p@pwm,xlab = 'position',color_profile = color_profile1,
          frame_width = 1,
          pop_name = 'Change color',
          control = list(viewport.margin.left = 5))

```


### Other entropy measures 

Besides the default Shannon entropy, `logomaker` can also determine the Information content using Renyi entropy. For this entropy measure, the Information content at position $i$ is $IC_{i,\alpha}=\frac{1}{1-\alpha}\Sigma_b\log_2(q_{b,i}^\alpha-0.25^{1-\alpha})$. When $\alpha\rightarrow1$, the limiting value of Renyi entropy is the Shannon entropy. In `logomaker`, `alpha` is a control parameter that can be tuned to get plots for different entropy measures. The figure below shows the logo plots with different values of $\alpha$.

```{r,message=FALSE,warning=FALSE,fig.height=7,fig.width=9}
get_viewport_logo(1, 2)
seekViewport(paste0("plotlogo", 1))
logomaker(p@pwm,xlab = 'position',color_profile = color_profile,
          frame_width = 1,
          newpage = FALSE,
          pop_name = 'Logo plot, Alpha=2',
          control = list(viewport.margin.left = 5,alpha=2))


seekViewport(paste0("plotlogo", 2))
logomaker(p@pwm,xlab = 'position',color_profile = color_profile,
          frame_width = 1,
          newpage = FALSE,
          pop_name = 'Logo plot, Alpha=0.2',
          control = list(viewport.margin.left = 5,alpha=0.2))
```






## EDLogo Plot 

### Intuition

Standard logo plots primarily highlight enrichment of characters at a position. We introduce an alternative logo plot called \textit{EDLogo} that highlights both enrichment and depletion, thereby leading to a more visually parsimonious representation. For examples, suppose for a particular position $i$, the base composition of $ \left (A, C, G, T \right)$ is as follows 

$$ \left (A, C, G, T \right ) : = \left ( 0.33, 0.33, 0.01, 0.33 \right )  $$

Then the logo plot above would highlight $A, C, T$ for that position. Also, the information content would be lower compared to an enrichment of a single symbol. But, a more ideal representation would be to show the depletion of $G$ instead since that is the base that has changed the most from normal.  

We use `nlogomaker` function in Logolas to plot the *EDLogo*. Various scoring schemes and scaling options are available for the *EDLogo*, which we demonstrate in our algorithm below. 

### Algorithm for nlogomaker height detection

Following are the steps to determine the heights of the logos for `log` based approach. 

For each position of the sequence, $ p = ((p_{b}))$ be the vector of relative frequencies of the bases at that position and $q = ((q_{b}))$ be the corresponding background. 

1. For the default option (`log` approach), compute a score $r_{b}$ 

$$ r_b=\log_2\frac{p_b+\epsilon}{q_b+\epsilon}-median \left (\log_2\frac{p_b + \epsilon}{q_b + \epsilon} : b = 1(|) B \right) $$

3. Determine $ r^{+}_{b} = max (r_b, 0) $ and $ r^{-}_{b} = max(-r_b, 0) $. 

5. For the `ic` scaling approach, we also calculate the IC measure for that position (based on Shannon entropy or Renyi entropy) 

6.Caluclate $ r^{+}_{b} \leftarrow  IC * \frac{r^{+}_{b}}{\sum_{b} r^{+}_{b}} $ and $ r^{-}_{b} \leftarrow  IC *  \frac{r^{-}_{b}}{\sum_{b} r^{-}_{b}} $.

4. $ r^{+}_{b} $ scores are plotted along the positive Y axis and $ r^{-}_{b} $ scores are plotted along the negative Y axis. 

### Scaling and Scoring schemes

Besides the `log` (unscaled) and `ic-log` (scaled) versions discussed here, **Logolas** offers other measures that replace the log ratio in Step 2 by ratio, or log-odds ratio or by probability weighted KL ratio. See the options for `logoheight` in `nlogomaker`. 

```{r,message=FALSE,warning=FALSE,fig.height=10,fig.width=8}

get_viewport_logo(2, 2, heights_1 = 20)
seekViewport(paste0("plotlogo", 1))
nlogomaker(p@pwm,logoheight = 'log',color_profile = color_profile,frame_width = 1,newpage = FALSE)


seekViewport(paste0("plotlogo", 2))
nlogomaker(p@pwm,logoheight = 'ic_log',color_profile = color_profile,frame_width = 1,newpage = FALSE)

seekViewport(paste0("plotlogo", 3))
nlogomaker(p@pwm,logoheight = 'ratio',color_profile = color_profile,frame_width = 1,newpage = FALSE)

seekViewport(paste0("plotlogo", 4))
nlogomaker(p@pwm,logoheight = 'ic_ratio',color_profile = color_profile,frame_width = 1,newpage = FALSE)

```

All the versions of the \textit{EDLogo} capture the strong depletion of T at the position 4, which is downplayed by the standard logo. At the same time, like the standrad logo, the enrichments are also clearly highlighted by the \textit{EDLogo} plot. The depletion signal is clearer in the unscaled versions and the scaled versions still seem slightly biased towards enrichments
 

### Border and fill

Logolas allows the user to customize the border and fill of the logos and also have separate border and fill rules for the enrichment and depletion of logos. The figure below shows the various options of choosing border and fill for making the logos.

```{r,message=FALSE,warning=FALSE,fig.height=10,fig.width=8}
get_viewport_logo(2, 2, heights_1 = 20)

seekViewport(paste0("plotlogo", 1))
nlogomaker(p@pwm,xlab = 'position',logoheight = "log",
color_profile = color_profile,control = list(tofill_pos = TRUE, tofill_neg=FALSE), newpage = FALSE)

seekViewport(paste0("plotlogo", 2))
nlogomaker(p@pwm,xlab = 'position',logoheight = "log",
color_profile = color_profile, control = list(tofill_pos = FALSE, tofill_neg=TRUE), newpage = FALSE)

seekViewport(paste0("plotlogo", 3))
nlogomaker(p@pwm,xlab = 'position',logoheight = "log", color_profile = color_profile,control = list(tofill_pos = TRUE, tofill_neg=TRUE),
newpage = FALSE)

seekViewport(paste0("plotlogo", 4))
nlogomaker(p@pwm,xlab = 'position',logoheight = "log", color_profile = color_profile, control = list(tofill_pos = FALSE, tofill_neg=FALSE),
newpage = FALSE)

```

## Session information

<!-- Insert the session information into the document -->
```{r session-info}
```
