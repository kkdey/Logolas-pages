---
title: "Generating Consensus sequence from EDLogo"
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```


IUPAC has a specific nomenclature to call bases at each position of the sequence based on their relative probabilities of occurrence. See the nomenclature [here](https://www.bioinformatics.org/sms/iupac.html). 

In the package `atSNP` by Sunduz Keles' lab, a  `GetIUPACSequence` function has been proposed to generate a consensus sequence based on IUPAC nomenclature from the position weight matrix. 

```{r,message=FALSE,warning=FALSE}
library(Logolas)
library(atSNP)

pwm=matrix(c(0.8,0.1,0.1,0,0.9,0.1,0,0,0.9,0.05,0.05,0,0.5,0.4,0,0.1,0.6,0.4,0,0,0.4,0.4,0.1,0.1,0.5,0,0.2,0.3,0.35,0.35,0.06,0.24,0.4,0.3,0.2,0.1,0.4,0.2,0.2,0.2,0.28,0.24,0.24,0.24,0.5,0.16,0.17,0.17,0.6,0.13,0.13,0.14,0.7,0.15,0.15,0),nrow = 4,byrow = F)
rownames(pwm)=c('A','C','G','T')
colnames(pwm)=1:ncol(pwm)

GetIUPACSequence(t(pwm))
```

In `Logolas`, we can use the scoring scheme in an EDLogo plot to call the bases at each position and generate a new consensus sequence based on our own nomenclature that equally highlights enrichment and depletion. 


```{r,message=FALSE,warning=FALSE}
color_profile=list("type" = "per_row","col" = RColorBrewer::brewer.pal(4,name ="Spectral"))
logomaker(pwm,color_profile = color_profile,frame_width = 1)
nlogomaker(pwm,logoheight = 'log',color_profile = color_profile,frame_width = 1)
```

In this nomenclature, we use uppercase of the symbol to depict enrichment and lowercase of a symbol to depict depletion of that symbol.

```{r message= FALSE, warning = FALSE}
GetConsensusSeq(pwm)
```

As is clear from the EDLogo plot, the consensus sequence using this nomenclature
is a more informative representation. 


```{r,message=FALSE,warning=FALSE,eval=FALSE,include=FALSE}
#discarded protein part

if(seqmotif=='protein'){
   bases=rownames(pwm)
  based=tolower(bases)
  for(i in 1:ncol(pwm)){
    codes=c()
    #based on (0.6,0.4)
    if(sum(pp[,i]>=1.1)>0){codes=c(codes,paste(bases[pp[,i]>=1.1],collapse =''))}
    if(sum(nn[,i]>=0.45)>0){codes=c(codes,paste(based[nn[,i]>=0.4],collapse =''))}
    if(is.null(codes)){codes=c(codes,'N')}
    if(length(codes)>1){codes=paste0('[',paste0(codes,collapse = '|'),']',sep='')}
    code[i]=codes
  } 
  }

#Also, it works well with the protein seqence.
counts_mat <- rbind(c(0, 0, 100, 1, 2), c(4, 3, 30, 35, 2),
c(100, 0, 10, 2, 7),rep(0,5),
c(4, 2, 3, 7, 70), c(1, 8, 0, 60, 3),
rep(0, 5), c(4, 2, 100, 1, 1),
c(12, 8, 16, 7, 20), c(55, 0, 1, 0, 12),
rep(0,5), c(rep(0,3), 20, 0),
rep(0,5), c(0, 0, 30, 0, 22),
c(1, 0, 12, 3, 10), rep(0,5),
c(0, 1, 0, 34, 1), c(0, 1, 12, 35, 1),
c(0, 30, 1, 10, 2), c(0, 1, 4, 100, 2))

rownames(counts_mat) <- c("A", "R", "N", "D","C", "E", "Q", "G",
"H", "I", "L", "K", "M", "F", "P", "S",
"T", "W", "Y", "V")
colnames(counts_mat) <- c("Pos 1", "Pos 2", "Pos 3", "Pos 4", "Pos 5")

GetMotif(counts_mat,'protein')

cols1 <- c(rev(RColorBrewer::brewer.pal(12, "Paired"))[c(3,4,7,8,11,12,5,6,9,10)],
RColorBrewer::brewer.pal(12, "Set3")[c(1,2,5,8,9)],
RColorBrewer::brewer.pal(9, "Set1")[c(9,7)],
RColorBrewer::brewer.pal(8, "Dark2")[c(3,4,8)])
color_profile <- list("type" = "per_row",
"col" = cols1)

logomaker(counts_mat,
color_profile = color_profile,
frame_width = 1)

```

## Session information

<!-- Insert the session information into the document -->
```{r session-info}
```
